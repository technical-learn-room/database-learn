## InnoDB의 MVCC  

#### MVCC란?  
`MVCC`는 `Multi Version Concurrency Control`의 약자로  
우리가 쓰기 작업을 하면서 읽기 작업도 동시에 가능하도록 하는 기술입니다.  

> `MySQL`에 종속된 기술은 아닙니다.  

#### MVCC의 동작  
`MVCC` 기술이 작동하는 방식은 스토리지 엔진마다 다릅니다.  
하지만 여기서는 대표적인 `InnoDB` 스토리지 엔진의 동작 방식만 알아볼 것입니다.  

또한 `MVCC`는 데이터베이스의 격리 수준에 따라 동작할 수도 있고 동작하지 않을 수도 있는데,  
이는 `MVCC`가 트랜잭션과 밀접한 연관이 있기 때문입니다.  

`InnoDB`에서 `MVCC`를 구현할 때 트랜잭션 버전을 이용하여 구현합니다.  
테이블의 레코드는 각각 생성 번호와 소멸 번호를 가지고 있는데  
이는 그 레코드가 생성된 시점의 트랜잭션 버전과 소멸된 시점의 트랜잭션 버전입니다.  
레코드가 수정될 경우 새 레코드를 만들며, 이전의 레코드는 삭제 처리합니다.  
삭제될 경우에는 삭제 번호를 매기며, 삽입시 생성 번호를 매깁니다.  

삽입, 삭제, 수정의 경우에는 `READ COMMITTED` 수준과 `REPEATABLE READ` 수준이 같은 동작을 하지만  
조회는 격리 수준의 특징에 따라 조금씩 다릅니다.  

- READ COMMITTED
    - 조회시 삭제 번호가 없거나, 현재 트랜잭션 버전보다 큰 번호인 레코드만 조회합니다.
- REPEATABLE READ
    - 조회시 삭제 번호가 없거나, 현재 트랜잭션 버전보다 큰 번호인 레코드만 조회합니다.
    - 조회시 생성 번호가 현재 트랜잭션 버전과 같거나 작은 번호인 레코드만 조회합니다.

> `READ UNCOMMITTED` 수준은 모든 트랜잭션의 동작이 현재 트랜잭션에 영향을 미치므로 버전과 관계 없이 조회가 되어야 하고,  
> `SERIALZABLE` 수준은 현재 트랜잭션이 들어서는 순간 락을 걸어버려 아무도 건들지 못하기 때문에 버전 조회가 무의미합니다.  
